
if(!jQuery.Zend){jQuery.Zend={};}
jQuery.Zend.jsonrpc=function(options){return new(function(options){var self=this;this.options=jQuery.extend({url:'',version:'',async:false,success:function(){},error:function(){},asyncReflect:false,asyncSuccess:function(){},asyncError:function(){},smd:null,exceptionHandler:null},options);this.sequence=1;this.error=false;this.setAsync=function(toggle){self.options.async=toggle;return self;};this.setAsyncSuccess=function(callback){self.options.success=callback;return self;}
this.setAsyncError=function(callback){self.options.error=callback;return self;}
var buildCallbacks=function(data){if(!self.options.version){if(data.envelope=="JSON-RPC-1.0"){self.options.version=1;}else{self.options.version=2;}}
var detectNamespace=new RegExp("([^.]+)\\.([^.]+)");jQuery.each(data.methods,function(key,val){var new_method=function(){var params=new Array();for(var i=0;i<arguments.length;i++){params.push(arguments[i]);}
var id=(self.sequence++);var reply=[];var successCallback=false;var exceptionHandler=false;var errorCallback=false;if(self.options.async&&params.length){if(typeof params[params.length-1]=='object'){var potentialCallbacks=params[params.length-1];if(jQuery.isFunction(potentialCallbacks.cb)){successCallback=potentialCallbacks.cb;}else if(jQuery.isFunction(potentialCallbacks.success)){successCallback=potentialCallbacks.success;}
if(jQuery.isFunction(potentialCallbacks.ex)){exceptionHandler=potentialCallbacks.ex;}else if(jQuery.isFunction(potentialCallbacks.exceptionHandler)){exceptionHandler=potentialCallbacks.exceptionHandler;}
if(jQuery.isFunction(potentialCallbacks.er)){errorCallback=potentialCallbacks.er;}else if(jQuery.isFunction(potentialCallbacks.error)){errorCallback=potentialCallbacks.error;}}}
if(self.options.version==1){var tosend={method:key,params:params,id:id};}else{var tosend={jsonrpc:'2.0',method:key,params:params,id:id};}
jQuery.ajax({async:self.options.async,contentType:'application/json',type:data.transport,processData:false,dataType:'json',url:self.options.url,cache:false,data:JSON.stringify(tosend),error:function(req,stat,err){self.error=true;self.error_message=stat;self.error_request=req;if(self.options.async){if(jQuery.isFunction(errorCallback)){errorCallback(self,req,stat,err,id,key);}
self.options.error(self,req,stat,err,id,key);}},success:function(inp){if((typeof inp.error=='object')&&(inp.error!=null)){reply=inp.error;if(jQuery.isFunction(exceptionHandler)){exceptionHandler(inp.error);return;}else if(jQuery.isFunction(self.options.exceptionHandler)){self.options.exceptionHandler(inp.error);return;}}else{reply=inp.result;}
if(self.options.async){if(jQuery.isFunction(successCallback)){successCallback(reply,id,key);}
self.options.success(reply,id,key);}}});if(self.options.async){return id;}else{return reply;}};var matches=detectNamespace.exec(key);if((!matches)||(!matches.length)){self[key]=new_method;}else{if(!self[matches[1]]){self[matches[1]]={};}
self[matches[1]][matches[2]]=new_method;}});if(self.options.asyncReflect){self.options.reflectSuccess(self);}};if(self.options.smd!=null){buildCallbacks(self.options.smd);}else{jQuery.ajax({async:self.options.asyncReflect,contentType:'application/json',type:'get',processData:false,dataType:'json',url:self.options.url,cache:false,error:function(req,stat,err){self.error=true;self.error_message=stat;self.error_request=req;if(self.options.asyncReflect){self.options.reflectError(self,req,stat,err);}},success:buildCallbacks});}
return this;})(options);};